using NUnit.Framework;
using TownSuite.Web.SSV3Adapter;

namespace TownSuite.Web.Tests;

[TestFixture]
public class SwaggerTest
{
    [Test]
    public async Task HappyPathTest()
    {
        var options = Settings.GetSettings();
        var serviceProvider = Settings.GetServiceProvider();

        var swag = new Swagger(options, serviceProvider,
            "description", "title", "1.1.1");
        var results = await swag.Generate("localhost");

        Assert.That(results.json,
            Is.EqualTo(
                "{\n  \"openapi\": \"3.0.1\",\n  \"info\": {\n    \"title\": \"TownSuite.SSV3Adapter\",\n    \"version\": \"v1\"\n  },\n  \"paths\": {\n    \"/service/json/syncreply/{name}/interfaceendpointexample\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.interfaceendpointexample\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/System.object\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/service/json/syncreply/{name}/example2\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.example2\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.example2response\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/service/json/syncreply/{name}/exampledataprofiling\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.exampledataprofiling\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.exampledataprofilingresponse\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/service/json/syncreply/{name}/example3\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.example3\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.example3response\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/service/json/syncreply/{name}/example\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.example\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.exampleresponse\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/service/json/syncreply/{name}/validnestedexample\": {\n      \"post\": {\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.validnestedexample\"\n              }\n            }\n          }\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Success\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/TownSuite.Web.Example.ServiceStackExample.validnestedexampleresponse\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"components\": {\n    \"schemas\": {\n      \"TownSuite.Web.Example.ServiceStackExample.interfaceendpointexample\": {\n        \"type\": \"object\",\n        \"description\": \"\"\n      },\n      \"System.object\": {\n        \"type\": \"object\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.example2\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"Number1\": {\n            \"type\": \"number\"\n          },\n          \"Number2\": {\n            \"type\": \"number\"\n          },\n          \"Model\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"Message\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"description\": \"\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.example2response\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"Calculated\": {\n            \"type\": \"number\"\n          },\n          \"Model\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"Message\": {\n                \"type\": \"string\"\n              }\n            }\n          },\n          \"TestMultiClassUsage\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"Message\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.exampledataprofiling\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"Number1\": {\n            \"type\": \"number\"\n          },\n          \"Number2\": {\n            \"type\": \"number\"\n          },\n          \"Model\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"Message\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"description\": \"\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.exampledataprofilingresponse\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"Calculated\": {\n            \"type\": \"number\"\n          },\n          \"Model\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"Message\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.example3\": {\n        \"type\": \"object\",\n        \"description\": \"\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.example3response\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"FirstName\": {\n            \"type\": \"string\"\n          },\n          \"LastName\": {\n            \"type\": \"string\"\n          }\n        }\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.example\": {\n        \"type\": \"object\",\n        \"description\": \"\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.exampleresponse\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"FirstName\": {\n            \"type\": \"string\"\n          },\n          \"LastName\": {\n            \"type\": \"string\"\n          }\n        }\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.validnestedexample\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"Input\": {\n            \"type\": \"string\"\n          }\n        },\n        \"description\": \"\"\n      },\n      \"TownSuite.Web.Example.ServiceStackExample.validnestedexampleresponse\": {\n        \"type\": \"object\"\n      }\n    }\n  }\n}"));
        Assert.That(results.statusCode == 200);
    }
}